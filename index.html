<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>HTMLプレビュー</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; }
    textarea { width: 100%; height: 200px; font-family: monospace; }
    #preview-container { margin-top: 20px; position: relative; }
    iframe { width: 100%; height: 300px; border: 1px solid #ccc; }
    #fullscreen-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: white; z-index: 9999; display: none; flex-direction: column;
    }
    #fullscreen-iframe { flex: 1; border: none; }
    #exit-fullscreen {
      background: #333; color: white; padding: 10px; text-align: right;
      cursor: pointer; font-size: 14px;
    }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>HTMLコード入力</h2>
  <textarea id="html-input" placeholder="ここにHTMLを入力してください"></textarea>
  <button onclick="renderPreview()">プレビュー</button>
  <button onclick="enterFullscreen()">フルスクリーン表示</button>

  <div id="preview-container">
    <iframe id="preview-frame"></iframe>
  </div>

  <div id="fullscreen-overlay">
    <div id="exit-fullscreen" onclick="exitFullscreen()">⏎ フルスクリーン解除</div>
    <iframe id="fullscreen-iframe"></iframe>
  </div>

  <script>
    function renderPreview() {
      const html = document.getElementById('html-input').value;
      const previewFrame = document.getElementById('preview-frame');

      // キャッシュ干渉防止：iframeを一旦削除して再生成
      const newFrame = document.createElement('iframe');
      newFrame.id = 'preview-frame';
      newFrame.style.width = '100%';
      newFrame.style.height = '300px';
      newFrame.style.border = '1px solid #ccc';

      previewFrame.parentNode.replaceChild(newFrame, previewFrame);

      // HTMLをBlobとして安全に読み込む
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      newFrame.src = url;

      // メモリ解放：古いURLを解放
      setTimeout(() => URL.revokeObjectURL(url), 5000);
    }

    function enterFullscreen() {
      const html = document.getElementById('html-input').value;
      const fullscreenIframe = document.getElementById('fullscreen-iframe');
      const overlay = document.getElementById('fullscreen-overlay');

      // キャッシュ干渉防止：iframe再生成
      const newFrame = document.createElement('iframe');
      newFrame.id = 'fullscreen-iframe';
      newFrame.style.flex = '1';
      newFrame.style.border = 'none';

      fullscreenIframe.parentNode.replaceChild(newFrame, fullscreenIframe);

      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      newFrame.src = url;

      overlay.style.display = 'flex';

      setTimeout(() => URL.revokeObjectURL(url), 5000);
    }

    function exitFullscreen() {
      document.getElementById('fullscreen-overlay').style.display = 'none';
    }
  </script>
</body>
</html>
